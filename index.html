<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåæ Smart Agricultural Advisor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            background: linear-gradient(135deg, #4CAF50 0%, #8BC34A 100%);
            color: white;
            padding: 40px 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(76, 175, 80, 0.3);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            overflow-x: auto;
        }

        .nav-tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            border: none;
            background: none;
            cursor: pointer;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-width: 120px;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
            color: white;
            box-shadow: 0 3px 10px rgba(76, 175, 80, 0.3);
        }

        .nav-tab:hover:not(.active) {
            background: #f0f0f0;
        }

        .content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .api-keys-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .api-key-card {
            background: #f9f9f9;
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid #4CAF50;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .api-key-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .api-key-card h3 {
            color: #333;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .api-key-card p {
            color: #666;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        .input-group {
            position: relative;
            margin-bottom: 15px;
        }

        .input-group input {
            width: 100%;
            padding: 12px 40px 12px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus {
            border-color: #4CAF50;
            outline: none;
        }

        .input-group .toggle-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            color: #666;
            font-size: 1.1rem;
        }

        .btn {
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        .btn.danger {
            background: linear-gradient(135deg, #f44336, #e57373);
        }

        .btn.secondary {
            background: linear-gradient(135deg, #607D8B, #90A4AE);
        }

        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status.configured {
            background: #4CAF50;
            color: white;
        }

        .status.missing {
            background: #f44336;
            color: white;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .feature-card {
            background: linear-gradient(135deg, #f9f9f9, #ffffff);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            cursor: pointer;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-color: #4CAF50;
        }

        .feature-card .icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .feature-card h3 {
            margin-bottom: 10px;
            color: #333;
        }

        .feature-card p {
            color: #666;
            font-size: 0.9rem;
        }

        .alert {
            background: linear-gradient(135deg, #FF9800, #FFC107);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .help-section {
            background: #e8f5e8;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .help-section h4 {
            color: #2E7D32;
            margin-bottom: 10px;
        }

        .help-section ul {
            list-style: none;
            padding-left: 0;
        }

        .help-section li {
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }

        .help-section li:before {
            content: "‚úì";
            color: #4CAF50;
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-card .value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-card .label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .container {
                padding: 10px;
            }
            
            .content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><span>üåæ</span>Smart Agricultural Advisor</h1>
            <p>AI-driven decision support system for farmers with built-in API key management</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('dashboard')">üè† Dashboard</button>
            <button class="nav-tab" onclick="showTab('api-keys')">üîë API Keys</button>
            <button class="nav-tab" onclick="showTab('features')">üåæ Features</button>
            <button class="nav-tab" onclick="showTab('weather')">üå§Ô∏è Weather</button>
            <button class="nav-tab" onclick="showTab('help')">‚ùì Help</button>
        </div>

        <div class="content">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <h2>üè† Farm Dashboard</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="value" id="api-status">‚ùå</div>
                        <div class="label">WeatherAPI Status</div>
                    </div>
                    <div class="stat-card">
                        <div class="value" id="setup-progress">Not Ready</div>
                        <div class="label">System Status</div>
                    </div>
                    <div class="stat-card">
                        <div class="value">6</div>
                        <div class="label">Data Sources</div>
                    </div>
                    <div class="stat-card">
                        <div class="value" id="monthly-calls">0</div>
                        <div class="label">Monthly API Calls</div>
                    </div>
                </div>

                <div id="setup-alert" class="alert" style="display: none;">
                    <span>‚ö†Ô∏è</span>
                    <span>Please configure your WeatherAPI key to unlock all agricultural features with a single API!</span>
                </div>

                <div class="feature-grid">
                    <div class="feature-card" onclick="showTab('api-keys')">
                        <div class="icon">üîë</div>
                        <h3>API Key Management</h3>
                        <p>Secure interface to manage your external service API keys</p>
                    </div>
                    <div class="feature-card" onclick="showTab('weather')">
                        <div class="icon">üå§Ô∏è</div>
                        <h3>Weather Analysis</h3>
                        <p>Real-time weather data and forecasts for your farm</p>
                    </div>
                    <div class="feature-card" onclick="showTab('features')">
                        <div class="icon">üå±</div>
                        <h3>Crop Recommendations</h3>
                        <p>AI-powered crop suggestions based on conditions</p>
                    </div>
                    <div class="feature-card" onclick="showTab('features')">
                        <div class="icon">üìä</div>
                        <h3>Market Intelligence</h3>
                        <p>Track commodity prices and market trends</p>
                    </div>
                </div>
            </div>

            <!-- API Keys Tab -->
            <div id="api-keys" class="tab-content">
                <h2>üîë API Key Management</h2>
                <p>Configure your WeatherAPI key to access comprehensive agricultural data. Your key is stored securely in your browser.</p>
                
                <div style="margin-bottom: 20px; text-align: center;">
                    <label style="font-weight: 600; margin-right: 10px;">Farm Location:</label>
                    <select id="location-select" onchange="updateLocationFromSelect()" 
                            style="padding: 8px 12px; border: 2px solid #ddd; border-radius: 20px; font-size: 0.9rem; margin-right: 10px; min-width: 300px; background: white; max-height: 200px;">
                        
                        <!-- Afghanistan -->
                        <optgroup label="üá¶üá´ Afghanistan">
                            <option value="Kabul, Afghanistan">Kabul</option>
                            <option value="Kandahar, Afghanistan">Kandahar</option>
                            <option value="Herat, Afghanistan">Herat</option>
                            <option value="Mazar-i-Sharif, Afghanistan">Mazar-i-Sharif</option>
                        </optgroup>
                        
                        <!-- Albania -->
                        <optgroup label="üá¶üá± Albania">
                            <option value="Tirana, Albania">Tirana</option>
                            <option value="Durres, Albania">Durres</option>
                            <option value="Vlore, Albania">Vlore</option>
                        </optgroup>
                        
                        <!-- Algeria -->
                        <optgroup label="üá©üáø Algeria">
                            <option value="Algiers, Algeria">Algiers</option>
                            <option value="Oran, Algeria">Oran</option>
                            <option value="Constantine, Algeria">Constantine</option>
                            <option value="Annaba, Algeria">Annaba</option>
                        </optgroup>
                        
                        <!-- Argentina -->
                        <optgroup label="üá¶üá∑ Argentina">
                            <option value="Buenos Aires, Argentina">Buenos Aires</option>
                            <option value="Cordoba, Argentina">Cordoba</option>
                            <option value="Rosario, Argentina">Rosario</option>
                            <option value="Mendoza, Argentina">Mendoza</option>
                            <option value="La Plata, Argentina">La Plata</option>
                            <option value="Tucuman, Argentina">Tucuman</option>
                            <option value="Mar del Plata, Argentina">Mar del Plata</option>
                            <option value="Salta, Argentina">Salta</option>
                        </optgroup>
                        
                        <!-- Australia -->
                        <optgroup label="üá¶üá∫ Australia">
                            <option value="Sydney, Australia">Sydney</option>
                            <option value="Melbourne, Australia">Melbourne</option>
                            <option value="Brisbane, Australia">Brisbane</option>
                            <option value="Perth, Australia">Perth</option>
                            <option value="Adelaide, Australia">Adelaide</option>
                            <option value="Gold Coast, Australia">Gold Coast</option>
                            <option value="Newcastle, Australia">Newcastle</option>
                            <option value="Canberra, Australia">Canberra</option>
                            <option value="Wollongong, Australia">Wollongong</option>
                            <option value="Darwin, Australia">Darwin</option>
                            <option value="Hobart, Australia">Hobart</option>
                            <option value="Cairns, Australia">Cairns</option>
                        </optgroup>
                        
                        <!-- Austria -->
                        <optgroup label="üá¶üáπ Austria">
                            <option value="Vienna, Austria">Vienna</option>
                            <option value="Salzburg, Austria">Salzburg</option>
                            <option value="Innsbruck, Austria">Innsbruck</option>
                            <option value="Graz, Austria">Graz</option>
                            <option value="Linz, Austria">Linz</option>
                        </optgroup>
                        
                        <!-- Bangladesh -->
                        <optgroup label="üáßüá© Bangladesh">
                            <option value="Dhaka, Bangladesh">Dhaka</option>
                            <option value="Chittagong, Bangladesh">Chittagong</option>
                            <option value="Khulna, Bangladesh">Khulna</option>
                            <option value="Rajshahi, Bangladesh">Rajshahi</option>
                            <option value="Sylhet, Bangladesh">Sylhet</option>
                            <option value="Barisal, Bangladesh">Barisal</option>
                        </optgroup>
                        
                        <!-- Belgium -->
                        <optgroup label="üáßüá™ Belgium">
                            <option value="Brussels, Belgium">Brussels</option>
                            <option value="Antwerp, Belgium">Antwerp</option>
                            <option value="Ghent, Belgium">Ghent</option>
                            <option value="Charleroi, Belgium">Charleroi</option>
                            <option value="Liege, Belgium">Liege</option>
                            <option value="Bruges, Belgium">Bruges</option>
                        </optgroup>
                        
                        <!-- Brazil -->
                        <optgroup label="üáßüá∑ Brazil">
                            <option value="Sao Paulo, Brazil">Sao Paulo</option>
                            <option value="Rio de Janeiro, Brazil">Rio de Janeiro</option>
                            <option value="Brasilia, Brazil">Brasilia</option>
                            <option value="Salvador, Brazil">Salvador</option>
                            <option value="Fortaleza, Brazil">Fortaleza</option>
                            <option value="Belo Horizonte, Brazil">Belo Horizonte</option>
                            <option value="Manaus, Brazil">Manaus</option>
                            <option value="Curitiba, Brazil">Curitiba</option>
                            <option value="Recife, Brazil">Recife</option>
                            <option value="Porto Alegre, Brazil">Porto Alegre</option>
                            <option value="Belem, Brazil">Belem</option>
                            <option value="Goiania, Brazil">Goiania</option>
                        </optgroup>
                        
                        <!-- Canada -->
                        <optgroup label="üá®üá¶ Canada">
                            <option value="Toronto, Canada">Toronto</option>
                            <option value="Montreal, Canada">Montreal</option>
                            <option value="Vancouver, Canada">Vancouver</option>
                            <option value="Calgary, Canada">Calgary</option>
                            <option value="Edmonton, Canada">Edmonton</option>
                            <option value="Ottawa, Canada">Ottawa</option>
                            <option value="Winnipeg, Canada">Winnipeg</option>
                            <option value="Quebec City, Canada">Quebec City</option>
                            <option value="Hamilton, Canada">Hamilton</option>
                            <option value="Kitchener, Canada">Kitchener</option>
                            <option value="London, Canada">London</option>
                            <option value="Halifax, Canada">Halifax</option>
                        </optgroup>
                        
                        <!-- Chile -->
                        <optgroup label="üá®üá± Chile">
                            <option value="Santiago, Chile">Santiago</option>
                            <option value="Valparaiso, Chile">Valparaiso</option>
                            <option value="Concepcion, Chile">Concepcion</option>
                            <option value="La Serena, Chile">La Serena</option>
                            <option value="Antofagasta, Chile">Antofagasta</option>
                            <option value="Temuco, Chile">Temuco</option>
                        </optgroup>
                        
                        <!-- China -->
                        <optgroup label="üá®üá≥ China">
                            <option value="Beijing, China">Beijing</option>
                            <option value="Shanghai, China">Shanghai</option>
                            <option value="Guangzhou, China">Guangzhou</option>
                            <option value="Shenzhen, China">Shenzhen</option>
                            <option value="Tianjin, China">Tianjin</option>
                            <option value="Wuhan, China">Wuhan</option>
                            <option value="Dongguan, China">Dongguan</option>
                            <option value="Chengdu, China">Chengdu</option>
                            <option value="Nanjing, China">Nanjing</option>
                            <option value="Chongqing, China">Chongqing</option>
                            <option value="Xian, China">Xian</option>
                            <option value="Hangzhou, China">Hangzhou</option>
                            <option value="Qingdao, China">Qingdao</option>
                        </optgroup>
                        
                        <!-- Colombia -->
                        <optgroup label="üá®üá¥ Colombia">
                            <option value="Bogota, Colombia">Bogota</option>
                            <option value="Medellin, Colombia">Medellin</option>
                            <option value="Cali, Colombia">Cali</option>
                            <option value="Barranquilla, Colombia">Barranquilla</option>
                            <option value="Cartagena, Colombia">Cartagena</option>
                            <option value="Cucuta, Colombia">Cucuta</option>
                        </optgroup>
                        
                        <!-- Denmark -->
                        <optgroup label="üá©üá∞ Denmark">
                            <option value="Copenhagen, Denmark">Copenhagen</option>
                            <option value="Aarhus, Denmark">Aarhus</option>
                            <option value="Odense, Denmark">Odense</option>
                            <option value="Aalborg, Denmark">Aalborg</option>
                        </optgroup>
                        
                        <!-- Egypt -->
                        <optgroup label="üá™üá¨ Egypt">
                            <option value="Cairo, Egypt">Cairo</option>
                            <option value="Alexandria, Egypt">Alexandria</option>
                            <option value="Giza, Egypt">Giza</option>
                            <option value="Shubra El-Kheima, Egypt">Shubra El-Kheima</option>
                            <option value="Port Said, Egypt">Port Said</option>
                            <option value="Luxor, Egypt">Luxor</option>
                        </optgroup>
                        
                        <!-- Finland -->
                        <optgroup label="üá´üáÆ Finland">
                            <option value="Helsinki, Finland">Helsinki</option>
                            <option value="Espoo, Finland">Espoo</option>
                            <option value="Tampere, Finland">Tampere</option>
                            <option value="Turku, Finland">Turku</option>
                            <option value="Oulu, Finland">Oulu</option>
                        </optgroup>
                        
                        <!-- France -->
                        <optgroup label="üá´üá∑ France">
                            <option value="Paris, France">Paris</option>
                            <option value="Marseille, France">Marseille</option>
                            <option value="Lyon, France">Lyon</option>
                            <option value="Toulouse, France">Toulouse</option>
                            <option value="Nice, France">Nice</option>
                            <option value="Nantes, France">Nantes</option>
                            <option value="Strasbourg, France">Strasbourg</option>
                            <option value="Montpellier, France">Montpellier</option>
                            <option value="Bordeaux, France">Bordeaux</option>
                            <option value="Lille, France">Lille</option>
                        </optgroup>
                        
                        <!-- Germany -->
                        <optgroup label="üá©üá™ Germany">
                            <option value="Berlin, Germany">Berlin</option>
                            <option value="Hamburg, Germany">Hamburg</option>
                            <option value="Munich, Germany">Munich</option>
                            <option value="Cologne, Germany">Cologne</option>
                            <option value="Frankfurt, Germany">Frankfurt</option>
                            <option value="Stuttgart, Germany">Stuttgart</option>
                            <option value="Dusseldorf, Germany">Dusseldorf</option>
                            <option value="Dortmund, Germany">Dortmund</option>
                            <option value="Essen, Germany">Essen</option>
                            <option value="Leipzig, Germany">Leipzig</option>
                        </optgroup>
                        
                        <!-- Greece -->
                        <optgroup label="üá¨üá∑ Greece">
                            <option value="Athens, Greece">Athens</option>
                            <option value="Thessaloniki, Greece">Thessaloniki</option>
                            <option value="Patras, Greece">Patras</option>
                            <option value="Heraklion, Greece">Heraklion</option>
                        </optgroup>
                        
                        <!-- India -->
                        <optgroup label="üáÆüá≥ India">
                            <option value="Mumbai, India">Mumbai</option>
                            <option value="Delhi, India">Delhi</option>
                            <option value="Bangalore, India">Bangalore</option>
                            <option value="Hyderabad, India">Hyderabad</option>
                            <option value="Ahmedabad, India">Ahmedabad</option>
                            <option value="Chennai, India">Chennai</option>
                            <option value="Kolkata, India">Kolkata</option>
                            <option value="Surat, India">Surat</option>
                            <option value="Pune, India">Pune</option>
                            <option value="Jaipur, India">Jaipur</option>
                            <option value="Lucknow, India">Lucknow</option>
                            <option value="Kanpur, India">Kanpur</option>
                            <option value="Nagpur, India">Nagpur</option>
                            <option value="Indore, India">Indore</option>
                            <option value="Bhopal, India">Bhopal</option>
                            <option value="Visakhapatnam, India">Visakhapatnam</option>
                            <option value="Kochi, India">Kochi</option>
                            <option value="Agra, India">Agra</option>
                        </optgroup>
                        
                        <!-- Indonesia -->
                        <optgroup label="üáÆüá© Indonesia">
                            <option value="Jakarta, Indonesia">Jakarta</option>
                            <option value="Surabaya, Indonesia">Surabaya</option>
                            <option value="Bandung, Indonesia">Bandung</option>
                            <option value="Bekasi, Indonesia">Bekasi</option>
                            <option value="Medan, Indonesia">Medan</option>
                            <option value="Tangerang, Indonesia">Tangerang</option>
                            <option value="Depok, Indonesia">Depok</option>
                            <option value="Semarang, Indonesia">Semarang</option>
                        </optgroup>
                        
                        <!-- Iran -->
                        <optgroup label="üáÆüá∑ Iran">
                            <option value="Tehran, Iran">Tehran</option>
                            <option value="Mashhad, Iran">Mashhad</option>
                            <option value="Isfahan, Iran">Isfahan</option>
                            <option value="Karaj, Iran">Karaj</option>
                            <option value="Tabriz, Iran">Tabriz</option>
                            <option value="Shiraz, Iran">Shiraz</option>
                        </optgroup>
                        
                        <!-- Iraq -->
                        <optgroup label="üáÆüá∂ Iraq">
                            <option value="Baghdad, Iraq">Baghdad</option>
                            <option value="Basra, Iraq">Basra</option>
                            <option value="Mosul, Iraq">Mosul</option>
                            <option value="Erbil, Iraq">Erbil</option>
                        </optgroup>
                        
                        <!-- Ireland -->
                        <optgroup label="üáÆüá™ Ireland">
                            <option value="Dublin, Ireland">Dublin</option>
                            <option value="Cork, Ireland">Cork</option>
                            <option value="Limerick, Ireland">Limerick</option>
                            <option value="Galway, Ireland">Galway</option>
                        </optgroup>
                        
                        <!-- Israel -->
                        <optgroup label="üáÆüá± Israel">
                            <option value="Jerusalem, Israel">Jerusalem</option>
                            <option value="Tel Aviv, Israel">Tel Aviv</option>
                            <option value="Haifa, Israel">Haifa</option>
                            <option value="Beer Sheva, Israel">Beer Sheva</option>
                        </optgroup>
                        
                        <!-- Italy -->
                        <optgroup label="üáÆüáπ Italy">
                            <option value="Rome, Italy">Rome</option>
                            <option value="Milan, Italy">Milan</option>
                            <option value="Naples, Italy">Naples</option>
                            <option value="Turin, Italy">Turin</option>
                            <option value="Palermo, Italy">Palermo</option>
                            <option value="Genoa, Italy">Genoa</option>
                            <option value="Bologna, Italy">Bologna</option>
                            <option value="Florence, Italy">Florence</option>
                            <option value="Venice, Italy">Venice</option>
                        </optgroup>
                        
                        <!-- Japan -->
                        <optgroup label="üáØüáµ Japan">
                            <option value="Tokyo, Japan">Tokyo</option>
                            <option value="Yokohama, Japan">Yokohama</option>
                            <option value="Osaka, Japan">Osaka</option>
                            <option value="Nagoya, Japan">Nagoya</option>
                            <option value="Sapporo, Japan">Sapporo</option>
                            <option value="Fukuoka, Japan">Fukuoka</option>
                            <option value="Kobe, Japan">Kobe</option>
                            <option value="Kyoto, Japan">Kyoto</option>
                            <option value="Kawasaki, Japan">Kawasaki</option>
                        </optgroup>
                        
                        <!-- Kenya -->
                        <optgroup label="üá∞üá™ Kenya">
                            <option value="Nairobi, Kenya">Nairobi</option>
                            <option value="Mombasa, Kenya">Mombasa</option>
                            <option value="Kisumu, Kenya">Kisumu</option>
                            <option value="Nakuru, Kenya">Nakuru</option>
                        </optgroup>
                        
                        <!-- Malaysia -->
                        <optgroup label="üá≤üáæ Malaysia">
                            <option value="Kuala Lumpur, Malaysia">Kuala Lumpur</option>
                            <option value="George Town, Malaysia">George Town</option>
                            <option value="Ipoh, Malaysia">Ipoh</option>
                            <option value="Shah Alam, Malaysia">Shah Alam</option>
                            <option value="Petaling Jaya, Malaysia">Petaling Jaya</option>
                        </optgroup>
                        
                        <!-- Mexico -->
                        <optgroup label="üá≤üáΩ Mexico">
                            <option value="Mexico City, Mexico">Mexico City</option>
                            <option value="Guadalajara, Mexico">Guadalajara</option>
                            <option value="Monterrey, Mexico">Monterrey</option>
                            <option value="Puebla, Mexico">Puebla</option>
                            <option value="Tijuana, Mexico">Tijuana</option>
                            <option value="Leon, Mexico">Leon</option>
                            <option value="Juarez, Mexico">Juarez</option>
                        </optgroup>
                        
                        <!-- Morocco -->
                        <optgroup label="üá≤üá¶ Morocco">
                            <option value="Casablanca, Morocco">Casablanca</option>
                            <option value="Rabat, Morocco">Rabat</option>
                            <option value="Fes, Morocco">Fes</option>
                            <option value="Marrakech, Morocco">Marrakech</option>
                        </optgroup>
                        
                        <!-- Netherlands -->
                        <optgroup label="üá≥üá± Netherlands">
                            <option value="Amsterdam, Netherlands">Amsterdam</option>
                            <option value="Rotterdam, Netherlands">Rotterdam</option>
                            <option value="The Hague, Netherlands">The Hague</option>
                            <option value="Utrecht, Netherlands">Utrecht</option>
                            <option value="Eindhoven, Netherlands">Eindhoven</option>
                        </optgroup>
                        
                        <!-- New Zealand -->
                        <optgroup label="üá≥üáø New Zealand">
                            <option value="Auckland, New Zealand">Auckland</option>
                            <option value="Wellington, New Zealand">Wellington</option>
                            <option value="Christchurch, New Zealand">Christchurch</option>
                            <option value="Hamilton, New Zealand">Hamilton</option>
                            <option value="Dunedin, New Zealand">Dunedin</option>
                        </optgroup>
                        
                        <!-- Nigeria -->
                        <optgroup label="üá≥üá¨ Nigeria">
                            <option value="Lagos, Nigeria">Lagos</option>
                            <option value="Kano, Nigeria">Kano</option>
                            <option value="Ibadan, Nigeria">Ibadan</option>
                            <option value="Abuja, Nigeria">Abuja</option>
                            <option value="Port Harcourt, Nigeria">Port Harcourt</option>
                        </optgroup>
                        
                        <!-- Norway -->
                        <optgroup label="üá≥üá¥ Norway">
                            <option value="Oslo, Norway">Oslo</option>
                            <option value="Bergen, Norway">Bergen</option>
                            <option value="Trondheim, Norway">Trondheim</option>
                            <option value="Stavanger, Norway">Stavanger</option>
                        </optgroup>
                        
                        <!-- Pakistan -->
                        <optgroup label="üáµüá∞ Pakistan">
                            <option value="Karachi, Pakistan">Karachi</option>
                            <option value="Lahore, Pakistan">Lahore</option>
                            <option value="Faisalabad, Pakistan">Faisalabad</option>
                            <option value="Rawalpindi, Pakistan">Rawalpindi</option>
                            <option value="Gujranwala, Pakistan">Gujranwala</option>
                            <option value="Peshawar, Pakistan">Peshawar</option>
                            <option value="Multan, Pakistan">Multan</option>
                        </optgroup>
                        
                        <!-- Peru -->
                        <optgroup label="üáµüá™ Peru">
                            <option value="Lima, Peru">Lima</option>
                            <option value="Arequipa, Peru">Arequipa</option>
                            <option value="Trujillo, Peru">Trujillo</option>
                            <option value="Chiclayo, Peru">Chiclayo</option>
                        </optgroup>
                        
                        <!-- Philippines -->
                        <optgroup label="üáµüáù Philippines">
                            <option value="Manila, Philippines">Manila</option>
                            <option value="Quezon City, Philippines">Quezon City</option>
                            <option value="Davao, Philippines">Davao</option>
                            <option value="Caloocan, Philippines">Caloocan</option>
                            <option value="Cebu City, Philippines">Cebu City</option>
                            <option value="Zamboanga, Philippines">Zamboanga</option>
                        </optgroup>
                        
                        <!-- Poland -->
                        <optgroup label="üáµüá± Poland">
                            <option value="Warsaw, Poland">Warsaw</option>
                            <option value="Krakow, Poland">Krakow</option>
                            <option value="Lodz, Poland">Lodz</option>
                            <option value="Wroclaw, Poland">Wroclaw</option>
                            <option value="Poznan, Poland">Poznan</option>
                            <option value="Gdansk, Poland">Gdansk</option>
                        </optgroup>
                        
                        <!-- Portugal -->
                        <optgroup label="üáµüáπ Portugal">
                            <option value="Lisbon, Portugal">Lisbon</option>
                            <option value="Porto, Portugal">Porto</option>
                            <option value="Vila Nova de Gaia, Portugal">Vila Nova de Gaia</option>
                            <option value="Amadora, Portugal">Amadora</option>
                        </optgroup>
                        
                        <!-- Russia -->
                        <optgroup label="üá∑üá∫ Russia">
                            <option value="Moscow, Russia">Moscow</option>
                            <option value="Saint Petersburg, Russia">Saint Petersburg</option>
                            <option value="Novosibirsk, Russia">Novosibirsk</option>
                            <option value="Yekaterinburg, Russia">Yekaterinburg</option>
                            <option value="Kazan, Russia">Kazan</option>
                            <option value="Nizhny Novgorod, Russia">Nizhny Novgorod</option>
                        </optgroup>
                        
                        <!-- Saudi Arabia -->
                        <optgroup label="üá∏üá¶ Saudi Arabia">
                            <option value="Riyadh, Saudi Arabia">Riyadh</option>
                            <option value="Jeddah, Saudi Arabia">Jeddah</option>
                            <option value="Mecca, Saudi Arabia">Mecca</option>
                            <option value="Medina, Saudi Arabia">Medina</option>
                            <option value="Dammam, Saudi Arabia">Dammam</option>
                        </optgroup>
                        
                        <!-- Singapore -->
                        <optgroup label="üá∏üá¨ Singapore">
                            <option value="Singapore, Singapore">Singapore</option>
                        </optgroup>
                        
                        <!-- South Africa -->
                        <optgroup label="üáøüá¶ South Africa">
                            <option value="Johannesburg, South Africa">Johannesburg</option>
                            <option value="Cape Town, South Africa">Cape Town</option>
                            <option value="Durban, South Africa">Durban</option>
                            <option value="Pretoria, South Africa">Pretoria</option>
                            <option value="Port Elizabeth, South Africa">Port Elizabeth</option>
                        </optgroup>
                        
                        <!-- South Korea -->
                        <optgroup label="üá∞üá∑ South Korea">
                            <option value="Seoul, South Korea">Seoul</option>
                            <option value="Busan, South Korea">Busan</option>
                            <option value="Incheon, South Korea">Incheon</option>
                            <option value="Daegu, South Korea">Daegu</option>
                            <option value="Daejeon, South Korea">Daejeon</option>
                            <option value="Gwangju, South Korea">Gwangju</option>
                        </optgroup>
                        
                        <!-- Spain -->
                        <optgroup label="üá™üá∏ Spain">
                            <option value="Madrid, Spain">Madrid</option>
                            <option value="Barcelona, Spain">Barcelona</option>
                            <option value="Valencia, Spain">Valencia</option>
                            <option value="Seville, Spain">Seville</option>
                            <option value="Zaragoza, Spain">Zaragoza</option>
                            <option value="Malaga, Spain">Malaga</option>
                            <option value="Murcia, Spain">Murcia</option>
                            <option value="Palma, Spain">Palma</option>
                        </optgroup>
                        
                        <!-- Sri Lanka -->
                        <optgroup label="üá±üá∞ Sri Lanka">
                            <option value="Colombo, Sri Lanka">Colombo</option>
                            <option value="Dehiwala-Mount Lavinia, Sri Lanka">Dehiwala-Mount Lavinia</option>
                            <option value="Moratuwa, Sri Lanka">Moratuwa</option>
                            <option value="Jaffna, Sri Lanka">Jaffna</option>
                        </optgroup>
                        
                        <!-- Sweden -->
                        <optgroup label="üá∏üá™ Sweden">
                            <option value="Stockholm, Sweden">Stockholm</option>
                            <option value="Gothenburg, Sweden">Gothenburg</option>
                            <option value="Malmo, Sweden">Malmo</option>
                            <option value="Uppsala, Sweden">Uppsala</option>
                        </optgroup>
                        
                        <!-- Switzerland -->
                        <optgroup label="üá®üáù Switzerland">
                            <option value="Zurich, Switzerland">Zurich</option>
                            <option value="Geneva, Switzerland">Geneva</option>
                            <option value="Basel, Switzerland">Basel</option>
                            <option value="Bern, Switzerland">Bern</option>
                        </optgroup>
                        
                        <!-- Thailand -->
                        <optgroup label="üáπüáù Thailand">
                            <option value="Bangkok, Thailand">Bangkok</option>
                            <option value="Nonthaburi, Thailand">Nonthaburi</option>
                            <option value="Nakhon Ratchasima, Thailand">Nakhon Ratchasima</option>
                            <option value="Chiang Mai, Thailand">Chiang Mai</option>
                            <option value="Hat Yai, Thailand">Hat Yai</option>
                        </optgroup>
                        
                        <!-- Turkey -->
                        <optgroup label="üáπüá∑ Turkey">
                            <option value="Istanbul, Turkey">Istanbul</option>
                            <option value="Ankara, Turkey">Ankara</option>
                            <option value="Izmir, Turkey">Izmir</option>
                            <option value="Bursa, Turkey">Bursa</option>
                            <option value="Adana, Turkey">Adana</option>
                            <option value="Gaziantep, Turkey">Gaziantep</option>
                        </optgroup>
                        
                        <!-- Ukraine -->
                        <optgroup label="üá∫üá¶ Ukraine">
                            <option value="Kiev, Ukraine">Kiev</option>
                            <option value="Kharkiv, Ukraine">Kharkiv</option>
                            <option value="Odessa, Ukraine">Odessa</option>
                            <option value="Dnipro, Ukraine">Dnipro</option>
                            <option value="Donetsk, Ukraine">Donetsk</option>
                        </optgroup>
                        
                        <!-- United Kingdom -->
                        <optgroup label="üá¨üáß United Kingdom">
                            <option value="London, United Kingdom" selected>London</option>
                            <option value="Birmingham, United Kingdom">Birmingham</option>
                            <option value="Leeds, United Kingdom">Leeds</option>
                            <option value="Glasgow, United Kingdom">Glasgow</option>
                            <option value="Sheffield, United Kingdom">Sheffield</option>
                            <option value="Bradford, United Kingdom">Bradford</option>
                            <option value="Liverpool, United Kingdom">Liverpool</option>
                            <option value="Edinburgh, United Kingdom">Edinburgh</option>
                            <option value="Manchester, United Kingdom">Manchester</option>
                            <option value="Bristol, United Kingdom">Bristol</option>
                        </optgroup>
                        
                        <!-- United States -->
                        <optgroup label="üá∫üá∏ United States">
                            <option value="New York, USA">New York</option>
                            <option value="Los Angeles, USA">Los Angeles</option>
                            <option value="Chicago, USA">Chicago</option>
                            <option value="Houston, USA">Houston</option>
                            <option value="Phoenix, USA">Phoenix</option>
                            <option value="Philadelphia, USA">Philadelphia</option>
                            <option value="San Antonio, USA">San Antonio</option>
                            <option value="San Diego, USA">San Diego</option>
                            <option value="Dallas, USA">Dallas</option>
                            <option value="San Jose, USA">San Jose</option>
                            <option value="Austin, USA">Austin</option>
                            <option value="Jacksonville, USA">Jacksonville</option>
                            <option value="San Francisco, USA">San Francisco</option>
                            <option value="Indianapolis, USA">Indianapolis</option>
                            <option value="Columbus, USA">Columbus</option>
                            <option value="Fort Worth, USA">Fort Worth</option>
                            <option value="Charlotte, USA">Charlotte</option>
                            <option value="Detroit, USA">Detroit</option>
                            <option value="El Paso, USA">El Paso</option>
                            <option value="Memphis, USA">Memphis</option>
                            <option value="Seattle, USA">Seattle</option>
                            <option value="Denver, USA">Denver</option>
                            <option value="Washington, USA">Washington</option>
                            <option value="Boston, USA">Boston</option>
                            <option value="Nashville, USA">Nashville</option>
                            <option value="Baltimore, USA">Baltimore</option>
                            <option value="Oklahoma City, USA">Oklahoma City</option>
                            <option value="Louisville, USA">Louisville</option>
                            <option value="Portland, USA">Portland</option>
                            <option value="Las Vegas, USA">Las Vegas</option>
                            <option value="Milwaukee, USA">Milwaukee</option>
                            <option value="Albuquerque, USA">Albuquerque</option>
                            <option value="Tucson, USA">Tucson</option>
                            <option value="Fresno, USA">Fresno</option>
                            <option value="Sacramento, USA">Sacramento</option>
                            <option value="Mesa, USA">Mesa</option>
                            <option value="Kansas City, USA">Kansas City</option>
                            <option value="Atlanta, USA">Atlanta</option>
                            <option value="Long Beach, USA">Long Beach</option>
                            <option value="Colorado Springs, USA">Colorado Springs</option>
                            <option value="Raleigh, USA">Raleigh</option>
                            <option value="Miami, USA">Miami</option>
                            <option value="Virginia Beach, USA">Virginia Beach</option>
                            <option value="Omaha, USA">Omaha</option>
                            <option value="Oakland, USA">Oakland</option>
                            <option value="Minneapolis, USA">Minneapolis</option>
                            <option value="Tulsa, USA">Tulsa</option>
                            <option value="Arlington, USA">Arlington</option>
                            <option value="New Orleans, USA">New Orleans</option>
                        </optgroup>
                        
                        <!-- Venezuela -->
                        <optgroup label="üáªüá™ Venezuela">
                            <option value="Caracas, Venezuela">Caracas</option>
                            <option value="Maracaibo, Venezuela">Maracaibo</option>
                            <option value="Valencia, Venezuela">Valencia</option>
                            <option value="Barquisimeto, Venezuela">Barquisimeto</option>
                        </optgroup>
                        
                        <!-- Vietnam -->
                        <optgroup label="üáªüá≥ Vietnam">
                            <option value="Ho Chi Minh City, Vietnam">Ho Chi Minh City</option>
                            <option value="Hanoi, Vietnam">Hanoi</option>
                            <option value="Haiphong, Vietnam">Haiphong</option>
                            <option value="Can Tho, Vietnam">Can Tho</option>
                            <option value="Da Nang, Vietnam">Da Nang</option>
                        </optgroup>
                        
                        <!-- Custom Option -->
                        <optgroup label="‚úèÔ∏è Custom Location">
                            <option value="custom">Enter Custom Location...</option>
                        </optgroup>
                        
                    </select>
                    
                    <div id="custom-location-input" style="display: none; margin-top: 10px;">
                        <input type="text" id="custom-location-text" placeholder="Enter your custom location" 
                               style="padding: 8px 12px; border: 2px solid #ddd; border-radius: 20px; font-size: 0.9rem; margin-right: 10px; min-width: 200px;">
                        <button class="btn" onclick="updateCustomLocation()" style="padding: 8px 16px;">Set Location</button>
                    </div>
                </div>
                <div class="api-key-card" style="max-width: 700px; margin: 0 auto 30px auto;">
                    <h3>üåç WeatherAPI - All-in-One <span class="status missing" id="weather-api-status">Missing</span></h3>
                    <p>Single API key for weather, agriculture, astronomy, and location data - Everything you need for smart farming!</p>
                    <div class="input-group">
                        <input type="password" id="weather-api-key" placeholder="Enter your WeatherAPI key">
                        <button class="toggle-btn" onclick="toggleVisibility('weather-api-key')">üëÅÔ∏è</button>
                    </div>
                    <button class="btn" onclick="saveApiKey('weather-api')">Save API Key</button>
                    <button class="btn danger" onclick="deleteApiKey('weather-api')">Remove</button>
                    
                    <div style="margin-top: 20px; background: linear-gradient(135deg, #e8f5e8, #f0f8f0); padding: 20px; border-radius: 12px; border-left: 4px solid #4CAF50;">
                        <h4 style="color: #2E7D32; margin-bottom: 15px;">üéÜ What You Get With One API Key:</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 2rem; margin-bottom: 8px;">üå§Ô∏è</div>
                                <strong>Weather Data</strong>
                                <p style="font-size: 0.8rem; margin-top: 5px;">Current conditions, forecasts, alerts</p>
                            </div>
                            <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 2rem; margin-bottom: 8px;">üå±</div>
                                <strong>Agriculture Data</strong>
                                <p style="font-size: 0.8rem; margin-top: 5px;">Growing degree days, soil temp</p>
                            </div>
                            <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 2rem; margin-bottom: 8px;">üåå</div>
                                <strong>Astronomy</strong>
                                <p style="font-size: 0.8rem; margin-top: 5px;">Sunrise, sunset, moon phases</p>
                            </div>
                            <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 2rem; margin-bottom: 8px;">üìà</div>
                                <strong>Air Quality</strong>
                                <p style="font-size: 0.8rem; margin-top: 5px;">Pollution levels, health indices</p>
                            </div>
                            <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 2rem; margin-bottom: 8px;">üó∫Ô∏è</div>
                                <strong>Location Data</strong>
                                <p style="font-size: 0.8rem; margin-top: 5px;">Timezone, coordinates, region info</p>
                            </div>
                            <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 2rem; margin-bottom: 8px;">üìÖ</div>
                                <strong>Historical Data</strong>
                                <p style="font-size: 0.8rem; margin-top: 5px;">Past weather patterns, trends</p>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107;">
                            <strong style="color: #856404;">üéÜ Free Tier Includes:</strong>
                            <ul style="margin: 10px 0; color: #856404; font-size: 0.9rem;">
                                <li>1,000,000 API calls per month</li>
                                <li>Current weather + 3-day forecast</li>
                                <li>Historical data (last 7 days)</li>
                                <li>Agriculture and astronomy data</li>
                                <li>Air quality information</li>
                            </ul>
                        </div>
                        
                        <div style="text-align: center; margin-top: 15px;">
                            <a href="https://www.weatherapi.com/signup.aspx" target="_blank" 
                               style="display: inline-block; background: linear-gradient(135deg, #4CAF50, #8BC34A); color: white; padding: 12px 24px; border-radius: 25px; text-decoration: none; font-weight: 600; box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);">
                                üéÜ Get Your FREE API Key
                            </a>
                            <p style="margin-top: 10px; font-size: 0.8rem; color: #666;">
                                Sign up at <strong>weatherapi.com</strong> - No credit card required!
                            </p>
                        </div>
                        
                        <div style="margin-top: 20px; padding: 15px; background: #e3f2fd; border-radius: 8px; font-size: 0.8rem;">
                            <strong style="color: #1565C0;">üìù Note about Browser Limitations:</strong><br>
                            ‚Ä¢ Some browsers may block direct API calls due to CORS policy<br>
                            ‚Ä¢ If weather data fails, the app will show smart seasonal recommendations instead<br>
                            ‚Ä¢ Crop analysis works offline using location and seasonal patterns<br>
                            ‚Ä¢ For full API access, consider running this app from a web server
                        </div>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn secondary" onclick="exportApiKeys()">üì• Export Keys</button>
                    <button class="btn secondary" onclick="importApiKeys()">üì§ Import Keys</button>
                    <button class="btn danger" onclick="clearAllKeys()">üóëÔ∏è Clear All</button>
                </div>
            </div>

            <!-- Features Tab -->
            <div id="features" class="tab-content">
                <h2>üåæ Agricultural Features</h2>
                
                <div class="feature-grid">
                    <div class="feature-card" onclick="testWeatherAPI()">
                        <div class="icon">üå±</div>
                        <h3>Crop Recommendations</h3>
                        <p>Smart crop suggestions based on WeatherAPI's soil temperature, growing degree days, and climate data</p>
                        <button class="btn" style="margin-top: 15px;" onclick="event.stopPropagation(); testWeatherAPI()">Get Recommendations</button>
                    </div>
                    
                    <div class="feature-card" onclick="testWeatherAPI()">
                        <div class="icon">üìÄ</div>
                        <h3>Yield Prediction</h3>
                        <p>Forecast yields using WeatherAPI's historical data, growing conditions, and weather patterns</p>
                        <button class="btn" style="margin-top: 15px;" onclick="event.stopPropagation(); testWeatherAPI()">Predict Yield</button>
                    </div>
                    
                    <div class="feature-card" onclick="testWeatherAPI()">
                        <div class="icon">üåø</div>
                        <h3>Soil Analysis</h3>
                        <p>Analyze soil conditions using WeatherAPI's soil temperature and moisture data</p>
                        <button class="btn" style="margin-top: 15px;" onclick="event.stopPropagation(); testWeatherAPI()">Analyze Soil</button>
                    </div>
                    
                    <div class="feature-card" onclick="testWeatherAPI()">
                        <div class="icon">üìà</div>
                        <h3>Air Quality Impact</h3>
                        <p>Monitor how air quality affects crop health using WeatherAPI's comprehensive air quality data</p>
                        <button class="btn" style="margin-top: 15px;" onclick="event.stopPropagation(); testWeatherAPI()">Check Air Quality</button>
                    </div>
                </div>
            </div>

            <!-- Weather Tab -->
            <div id="weather" class="tab-content">
                <h2>üå§Ô∏è Weather Analysis</h2>
                
                <div id="weather-setup-alert" class="alert">
                    <span>‚ö†Ô∏è</span>
                    <span>Configure your WeatherAPI key to access comprehensive weather and agricultural data. <a href="#" onclick="showTab('api-keys')" style="color: white; text-decoration: underline;">Setup now</a></span>
                </div>
                
                <div class="feature-grid">
                    <div class="feature-card" onclick="getCurrentWeather()">
                        <div class="icon">üå°Ô∏è</div>
                        <h3>Current Weather</h3>
                        <p>Real-time temperature, humidity, UV index, and agricultural conditions from WeatherAPI</p>
                        <div id="current-weather" style="margin-top: 15px; font-size: 0.9rem; color: #666;">
                            Click to get current weather data
                        </div>
                        <button class="btn" style="margin-top: 10px;" onclick="event.stopPropagation(); getCurrentWeather()">Get Current Data</button>
                    </div>
                    
                    <div class="feature-card" onclick="getForecast()">
                        <div class="icon">üìÖ</div>
                        <h3>10-Day Forecast</h3>
                        <p>Extended weather forecast with agricultural insights and growing degree days</p>
                        <div id="forecast-weather" style="margin-top: 15px; font-size: 0.9rem; color: #666;">
                            Click to get forecast data
                        </div>
                        <button class="btn" style="margin-top: 10px;" onclick="event.stopPropagation(); getForecast()">Get Forecast</button>
                    </div>
                    
                    <div class="feature-card" onclick="getAstronomyData()">
                        <div class="icon">üåå</div>
                        <h3>Astronomy & Timing</h3>
                        <p>Sunrise, sunset, moon phases, and optimal farming timing from WeatherAPI</p>
                        <div id="astronomy-data" style="margin-top: 15px; font-size: 0.9rem; color: #666;">
                            Click to get astronomy data
                        </div>
                        <button class="btn" style="margin-top: 10px;" onclick="event.stopPropagation(); getAstronomyData()">Get Astronomy</button>
                    </div>
                    
                    <div class="feature-card" onclick="getAirQuality()">
                        <div class="icon">üå¨Ô∏è</div>
                        <h3>Air Quality</h3>
                        <p>Air pollution levels, health indices, and impact on crop health from WeatherAPI</p>
                        <div id="air-quality-data" style="margin-top: 15px; font-size: 0.9rem; color: #666;">
                            Click to get air quality data
                        </div>
                        <button class="btn" style="margin-top: 10px;" onclick="event.stopPropagation(); getAirQuality()">Check Air Quality</button>
                    </div>
                </div>
            </div>

            <!-- Help Tab -->
            <div id="help" class="tab-content">
                <h2>‚ùì Help & Getting Started</h2>
                
                <div class="help-section">
                    <h4>üöÄ Quick Start Guide</h4>
                    <ul>
                        <li>Open the "API Keys" tab to configure your WeatherAPI key</li>
                        <li>Sign up for FREE at weatherapi.com (no credit card required)</li>
                        <li>Get your API key from the WeatherAPI dashboard</li>
                        <li>Enter your API key and click "Save API Key"</li>
                        <li>Your key is stored securely in your browser's local storage</li>
                        <li>Access ALL agricultural features with just one API key!</li>
                    </ul>
                </div>

                <div class="help-section">
                    <h4>üéÜ WeatherAPI - All-in-One Benefits</h4>
                    <ul>
                        <li><strong>Single API Key:</strong> No need for multiple service registrations</li>
                        <li><strong>Comprehensive Data:</strong> Weather, agriculture, astronomy, air quality</li>
                        <li><strong>Generous Free Tier:</strong> 1,000,000 API calls per month</li>
                        <li><strong>Real-time & Historical:</strong> Current conditions plus past data</li>
                        <li><strong>Agricultural Focus:</strong> Growing degree days, soil temperature</li>
                        <li><strong>Global Coverage:</strong> Worldwide weather and location data</li>
                    </ul>
                </div>

                <div class="help-section">
                    <h4>üåæ Features Overview</h4>
                    <ul>
                        <li>Dashboard: Overview of WeatherAPI status and farm readiness</li>
                        <li>API Keys: Simple one-key management for all data sources</li>
                        <li>Weather Analysis: Comprehensive weather and agricultural data</li>
                        <li>Agricultural Features: Crop recommendations, soil analysis, air quality</li>
                        <li>Astronomy Data: Optimal timing for farming operations</li>
                        <li>Historical Analysis: Past weather patterns and trends</li>
                    </ul>
                </div>

                <div class="help-section">
                    <h4>üîí Security & Privacy</h4>
                    <ul>
                        <li>Your WeatherAPI key is stored securely in your browser only</li>
                        <li>No farming data is stored on external servers</li>
                        <li>Data requests go directly to WeatherAPI - no middleman</li>
                        <li>Export/import functionality for easy backup</li>
                        <li>Complete data control - clear everything anytime</li>
                        <li>No user tracking or personal data collection</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // WeatherAPI Management
        const weatherApiService = 'weather-api';
        
        // Load saved API key on page load
        window.addEventListener('load', function() {
            loadWeatherApiKey();
            updateDashboard();
        });

        function showTab(tabName) {
            // Hide all tab contents
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Remove active class from all nav tabs
            const navTabs = document.querySelectorAll('.nav-tab');
            navTabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked nav tab
            event.target.classList.add('active');
        }

        function toggleVisibility(inputId) {
            const input = document.getElementById(inputId);
            const button = input.nextElementSibling;
            
            if (input.type === 'password') {
                input.type = 'text';
                button.textContent = 'üôà';
            } else {
                input.type = 'password';
                button.textContent = 'üëÅÔ∏è';
            }
        }

        function saveApiKey(service) {
            const input = document.getElementById(service + '-key');
            const key = input.value.trim();
            
            if (key) {
                localStorage.setItem('smartAgri_weatherapi', key);
                updateApiKeyStatus('weather-api', 'configured');
                showNotification('‚úÖ WeatherAPI key saved successfully! All agricultural features unlocked.', 'success');
            } else {
                showNotification('‚ùå Please enter a valid WeatherAPI key', 'error');
            }
            
            updateDashboard();
        }

        function deleteApiKey(service) {
            if (confirm('Are you sure you want to remove the WeatherAPI key? This will disable all agricultural features.')) {
                localStorage.removeItem('smartAgri_weatherapi');
                document.getElementById(service + '-key').value = '';
                updateApiKeyStatus('weather-api', 'missing');
                showNotification('üõ°Ô∏è WeatherAPI key removed', 'info');
                updateDashboard();
            }
        }
        function loadWeatherApiKey() {
            const key = localStorage.getItem('smartAgri_weatherapi');
            if (key) {
                document.getElementById('weather-api-key').value = key;
                updateApiKeyStatus('weather-api', 'configured');
            }
        }

        function updateApiKeyStatus(service, status) {
            const statusElement = document.getElementById(service + '-status');
            statusElement.textContent = status === 'configured' ? 'Configured' : 'Missing';
            statusElement.className = 'status ' + (status === 'configured' ? 'configured' : 'missing');
        }

        function exportApiKeys() {
            const weatherApiKey = localStorage.getItem('smartAgri_weatherapi');
            if (!weatherApiKey) {
                showNotification('‚ùå No WeatherAPI key to export', 'error');
                return;
            }
            
            const config = { weatherapi: weatherApiKey };
            const dataStr = JSON.stringify(config, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = 'smart-agri-weatherapi-config.json';
            link.click();
            
            showNotification('üì• WeatherAPI configuration exported successfully!', 'success');
        }

        function importApiKeys() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const config = JSON.parse(e.target.result);
                            if (config.weatherapi) {
                                localStorage.setItem('smartAgri_weatherapi', config.weatherapi);
                                loadWeatherApiKey();
                                updateDashboard();
                                showNotification('üì§ WeatherAPI configuration imported successfully!', 'success');
                            } else {
                                showNotification('‚ùå Invalid WeatherAPI configuration file', 'error');
                            }
                        } catch (error) {
                            showNotification('‚ùå Invalid configuration file', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function clearAllKeys() {
            if (confirm('Are you sure you want to clear the WeatherAPI key? This will disable all features.')) {
                localStorage.removeItem('smartAgri_weatherapi');
                document.getElementById('weather-api-key').value = '';
                updateApiKeyStatus('weather-api', 'missing');
                updateDashboard();
                showNotification('üõ°Ô∏è WeatherAPI key cleared', 'info');
            }
        }

        function updateDashboard() {
            const hasWeatherApiKey = localStorage.getItem('smartAgri_weatherapi');
            
            // Update dashboard stats
            document.getElementById('api-status').textContent = hasWeatherApiKey ? '‚úÖ' : '‚ùå';
            document.getElementById('setup-progress').textContent = hasWeatherApiKey ? 'Ready' : 'Not Ready';
            document.getElementById('monthly-calls').textContent = hasWeatherApiKey ? '0/1M' : '0';
            
            const setupAlert = document.getElementById('setup-alert');
            const weatherAlert = document.getElementById('weather-setup-alert');
            
            if (!hasWeatherApiKey) {
                setupAlert.style.display = 'flex';
                weatherAlert.style.display = 'flex';
            } else {
                setupAlert.style.display = 'none';
                weatherAlert.style.display = 'none';
            }
        }

        function showNotification(message, type) {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 10px;
                color: white;
                font-weight: 500;
                z-index: 10000;
                animation: slideIn 0.3s ease;
                max-width: 300px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            `;
            
            // Set background color based on type
            switch(type) {
                case 'success':
                    notification.style.background = 'linear-gradient(135deg, #4CAF50, #8BC34A)';
                    break;
                case 'error':
                    notification.style.background = 'linear-gradient(135deg, #f44336, #e57373)';
                    break;
                default:
                    notification.style.background = 'linear-gradient(135deg, #2196F3, #64B5F6)';
            }
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Remove notification after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
        // WeatherAPI Integration Functions
        let userLocation = 'London, United Kingdom'; // Default location, matches dropdown selection
        
        function testWeatherAPI() {
            getCurrentWeather(); // Test with actual API call
        }
        
        async function getCurrentWeather() {
            const apiKey = localStorage.getItem('smartAgri_weatherapi');
            if (!apiKey) {
                showNotification('‚ùå Please configure your WeatherAPI key first', 'error');
                showTab('api-keys');
                return;
            }
            
            try {
                showNotification('üå°Ô∏è Getting current weather data...', 'info');
                
                // Try direct API call first, then fallback to CORS proxy
                let response;
                try {
                    response = await fetch(`https://api.weatherapi.com/v1/current.json?key=${apiKey}&q=${userLocation}&aqi=yes`);
                } catch (corsError) {
                    // Fallback to CORS proxy
                    response = await fetch(`https://cors-anywhere.herokuapp.com/https://api.weatherapi.com/v1/current.json?key=${apiKey}&q=${userLocation}&aqi=yes`);
                }
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }
                
                const data = await response.json();
                
                document.getElementById('current-weather').innerHTML = `
                    <div style="background: linear-gradient(135deg, #e8f5e8, #f0f8f0); padding: 15px; border-radius: 10px; margin-top: 10px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <img src="https:${data.current.condition.icon}" alt="Weather" style="width: 40px; height: 40px;">
                            <div>
                                <div style="font-weight: 600; color: #2E7D32;">${data.location.name}, ${data.location.country}</div>
                                <div style="font-size: 0.8rem; color: #666;">${data.current.condition.text}</div>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; font-size: 0.8rem;">
                            <div><strong>üå°Ô∏è ${data.current.temp_c}¬∞C</strong><br>Temperature</div>
                            <div><strong>üíß ${data.current.humidity}%</strong><br>Humidity</div>
                            <div><strong>üí® ${data.current.wind_kph} km/h</strong><br>Wind Speed</div>
                            <div><strong>‚òÅÔ∏è ${data.current.cloud}%</strong><br>Cloud Cover</div>
                            <div><strong>üåÖ UV ${data.current.uv}</strong><br>UV Index</div>
                            <div><strong>üåßÔ∏è ${data.current.precip_mm} mm</strong><br>Precipitation</div>
                        </div>
                        <div style="margin-top: 10px; padding: 10px; background: #fff3cd; border-radius: 8px; font-size: 0.8rem;">
                            <strong>üåæ Agricultural Insights:</strong><br>
                            ‚Ä¢ Feels like: ${data.current.feelslike_c}¬∞C<br>
                            ‚Ä¢ Visibility: ${data.current.vis_km} km<br>
                            ‚Ä¢ Pressure: ${data.current.pressure_mb} mb<br>
                            ‚Ä¢ Dew Point: ${data.current.dewpoint_c}¬∞C
                        </div>
                    </div>
                `;
                
                showNotification('‚úÖ Current weather data loaded successfully!', 'success');
                
            } catch (error) {
                console.error('WeatherAPI Error:', error);
                document.getElementById('current-weather').innerHTML = `
                    <div style="color: #d32f2f; font-weight: 600; background: #ffebee; padding: 10px; border-radius: 8px;">
                        ‚ùå Error: ${error.message}<br>
                        <span style="font-weight: normal; font-size: 0.8rem;">Please check your API key and try again.</span>
                    </div>
                `;
                showNotification('‚ùå Failed to fetch weather data. Check your API key.', 'error');
            }
        }
        
        async function getForecast() {
            const apiKey = localStorage.getItem('smartAgri_weatherapi');
            if (!apiKey) {
                showNotification('‚ùå Please configure your WeatherAPI key first', 'error');
                showTab('api-keys');
                return;
            }
            
            try {
                showNotification('üìÖ Getting 7-day forecast...', 'info');
                
                // Try direct API call first, then fallback to CORS proxy
                let response;
                try {
                    response = await fetch(`https://api.weatherapi.com/v1/forecast.json?key=${apiKey}&q=${userLocation}&days=7&aqi=yes`);
                } catch (corsError) {
                    // Fallback to CORS proxy
                    response = await fetch(`https://cors-anywhere.herokuapp.com/https://api.weatherapi.com/v1/forecast.json?key=${apiKey}&q=${userLocation}&days=7&aqi=yes`);
                }
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }
                
                const data = await response.json();
                
                let forecastHtml = '<div style="background: linear-gradient(135deg, #e8f5e8, #f0f8f0); padding: 15px; border-radius: 10px; margin-top: 10px;">';
                forecastHtml += '<div style="font-weight: 600; color: #2E7D32; margin-bottom: 15px;">7-Day Weather Forecast</div>';
                
                data.forecast.forecastday.forEach((day, index) => {
                    const date = new Date(day.date);
                    const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });
                    
                    forecastHtml += `
                        <div style="display: flex; align-items: center; justify-content: space-between; padding: 8px; margin-bottom: 8px; background: white; border-radius: 8px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <img src="https:${day.day.condition.icon}" alt="Weather" style="width: 30px; height: 30px;">
                                <div>
                                    <div style="font-weight: 600; font-size: 0.9rem;">${dayName} ${date.getDate()}/${date.getMonth() + 1}</div>
                                    <div style="font-size: 0.7rem; color: #666;">${day.day.condition.text}</div>
                                </div>
                            </div>
                            <div style="text-align: right; font-size: 0.8rem;">
                                <div><strong>${day.day.maxtemp_c}¬∞/${day.day.mintemp_c}¬∞</strong></div>
                                <div style="color: #666;">üíß ${day.day.totalprecip_mm}mm</div>
                            </div>
                        </div>
                    `;
                });
                
                forecastHtml += '</div>';
                document.getElementById('forecast-weather').innerHTML = forecastHtml;
                
                showNotification('‚úÖ 7-day forecast loaded successfully!', 'success');
                
            } catch (error) {
                console.error('Forecast Error:', error);
                document.getElementById('forecast-weather').innerHTML = `
                    <div style="color: #d32f2f; font-weight: 600; background: #ffebee; padding: 10px; border-radius: 8px;">
                        ‚ùå Error: ${error.message}<br>
                        <span style="font-weight: normal; font-size: 0.8rem;">Please check your API key and try again.</span>
                    </div>
                `;
                showNotification('‚ùå Failed to fetch forecast data. Check your API key.', 'error');
            }
        }
        
        async function getAstronomyData() {
            const apiKey = localStorage.getItem('smartAgri_weatherapi');
            if (!apiKey) {
                showNotification('‚ùå Please configure your WeatherAPI key first', 'error');
                showTab('api-keys');
                return;
            }
            
            try {
                showNotification('üåå Getting astronomy data...', 'info');
                
                // Try direct API call first, then fallback to CORS proxy
                let response;
                try {
                    response = await fetch(`https://api.weatherapi.com/v1/astronomy.json?key=${apiKey}&q=${userLocation}&dt=${new Date().toISOString().split('T')[0]}`);
                } catch (corsError) {
                    // Fallback to CORS proxy
                    response = await fetch(`https://cors-anywhere.herokuapp.com/https://api.weatherapi.com/v1/astronomy.json?key=${apiKey}&q=${userLocation}&dt=${new Date().toISOString().split('T')[0]}`);
                }
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }
                
                const data = await response.json();
                
                document.getElementById('astronomy-data').innerHTML = `
                    <div style="background: linear-gradient(135deg, #e8f5e8, #f0f8f0); padding: 15px; border-radius: 10px; margin-top: 10px;">
                        <div style="font-weight: 600; color: #2E7D32; margin-bottom: 15px;">üåå Astronomy Data for ${data.location.name}</div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; font-size: 0.8rem;">
                            <div style="text-align: center; padding: 10px; background: white; border-radius: 8px;">
                                <div style="font-size: 1.5rem; margin-bottom: 5px;">üåÖ</div>
                                <div style="font-weight: 600;">Sunrise</div>
                                <div>${data.astronomy.astro.sunrise}</div>
                            </div>
                            <div style="text-align: center; padding: 10px; background: white; border-radius: 8px;">
                                <div style="font-size: 1.5rem; margin-bottom: 5px;">üåÜ</div>
                                <div style="font-weight: 600;">Sunset</div>
                                <div>${data.astronomy.astro.sunset}</div>
                            </div>
                            <div style="text-align: center; padding: 10px; background: white; border-radius: 8px;">
                                <div style="font-size: 1.5rem; margin-bottom: 5px;">üåô</div>
                                <div style="font-weight: 600;">Moonrise</div>
                                <div>${data.astronomy.astro.moonrise}</div>
                            </div>
                            <div style="text-align: center; padding: 10px; background: white; border-radius: 8px;">
                                <div style="font-size: 1.5rem; margin-bottom: 5px;">üåö</div>
                                <div style="font-weight: 600;">Moonset</div>
                                <div>${data.astronomy.astro.moonset}</div>
                            </div>
                            <div style="text-align: center; padding: 10px; background: white; border-radius: 8px;">
                                <div style="font-size: 1.5rem; margin-bottom: 5px;">üåï</div>
                                <div style="font-weight: 600;">Moon Phase</div>
                                <div>${data.astronomy.astro.moon_phase}</div>
                            </div>
                            <div style="text-align: center; padding: 10px; background: white; border-radius: 8px;">
                                <div style="font-size: 1.5rem; margin-bottom: 5px;">üåî</div>
                                <div style="font-weight: 600;">Moon Illumination</div>
                                <div>${data.astronomy.astro.moon_illumination}%</div>
                            </div>
                        </div>
                        <div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 8px; font-size: 0.8rem;">
                            <strong>üåæ Farming Insights:</strong><br>
                            ‚Ä¢ Best working hours: After sunrise (${data.astronomy.astro.sunrise}) to before sunset (${data.astronomy.astro.sunset})<br>
                            ‚Ä¢ Moon phase affects plant growth and harvesting timing<br>
                            ‚Ä¢ Current illumination: ${data.astronomy.astro.moon_illumination}% - Good for night activities
                        </div>
                    </div>
                `;
                
                showNotification('‚úÖ Astronomy data loaded successfully!', 'success');
                
            } catch (error) {
                console.error('Astronomy Error:', error);
                document.getElementById('astronomy-data').innerHTML = `
                    <div style="color: #d32f2f; font-weight: 600; background: #ffebee; padding: 10px; border-radius: 8px;">
                        ‚ùå Error: ${error.message}<br>
                        <span style="font-weight: normal; font-size: 0.8rem;">Please check your API key and try again.</span>
                    </div>
                `;
                showNotification('‚ùå Failed to fetch astronomy data. Check your API key.', 'error');
            }
        }
        
        async function getAirQuality() {
            const apiKey = localStorage.getItem('smartAgri_weatherapi');
            if (!apiKey) {
                showNotification('‚ùå Please configure your WeatherAPI key first', 'error');
                showTab('api-keys');
                return;
            }
            
            try {
                showNotification('üå¨Ô∏è Getting air quality data...', 'info');
                
                // Try direct API call first, then fallback to CORS proxy
                let response;
                try {
                    response = await fetch(`https://api.weatherapi.com/v1/current.json?key=${apiKey}&q=${userLocation}&aqi=yes`);
                } catch (corsError) {
                    // Fallback to CORS proxy
                    response = await fetch(`https://cors-anywhere.herokuapp.com/https://api.weatherapi.com/v1/current.json?key=${apiKey}&q=${userLocation}&aqi=yes`);
                }
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (!data.current.air_quality) {
                    throw new Error('Air quality data not available');
                }
                
                const aqi = data.current.air_quality;
                
                // Determine air quality status
                let aqiStatus = 'Good';
                let aqiColor = '#4CAF50';
                let aqiBg = '#e8f5e8';
                
                if (aqi['us-epa-index'] > 3) {
                    aqiStatus = 'Unhealthy';
                    aqiColor = '#f44336';
                    aqiBg = '#ffebee';
                } else if (aqi['us-epa-index'] > 2) {
                    aqiStatus = 'Moderate';
                    aqiColor = '#FF9800';
                    aqiBg = '#fff3e0';
                }
                
                document.getElementById('air-quality-data').innerHTML = `
                    <div style="background: linear-gradient(135deg, #e8f5e8, #f0f8f0); padding: 15px; border-radius: 10px; margin-top: 10px;">
                        <div style="font-weight: 600; color: #2E7D32; margin-bottom: 15px;">üå¨Ô∏è Air Quality for ${data.location.name}</div>
                        
                        <div style="background: ${aqiBg}; padding: 15px; border-radius: 8px; margin-bottom: 15px; text-align: center;">
                            <div style="font-size: 2rem; color: ${aqiColor}; font-weight: bold;">${aqi['us-epa-index']}</div>
                            <div style="color: ${aqiColor}; font-weight: 600;">${aqiStatus}</div>
                            <div style="font-size: 0.8rem; color: #666; margin-top: 5px;">US EPA Air Quality Index</div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; font-size: 0.8rem; margin-bottom: 15px;">
                            <div style="text-align: center; padding: 10px; background: white; border-radius: 8px;">
                                <div style="font-weight: 600;">CO</div>
                                <div>${aqi.co.toFixed(1)} ¬µg/m¬≥</div>
                            </div>
                            <div style="text-align: center; padding: 10px; background: white; border-radius: 8px;">
                                <div style="font-weight: 600;">NO2</div>
                                <div>${aqi.no2.toFixed(1)} ¬µg/m¬≥</div>
                            </div>
                            <div style="text-align: center; padding: 10px; background: white; border-radius: 8px;">
                                <div style="font-weight: 600;">O3</div>
                                <div>${aqi.o3.toFixed(1)} ¬µg/m¬≥</div>
                            </div>
                            <div style="text-align: center; padding: 10px; background: white; border-radius: 8px;">
                                <div style="font-weight: 600;">SO2</div>
                                <div>${aqi.so2.toFixed(1)} ¬µg/m¬≥</div>
                            </div>
                            <div style="text-align: center; padding: 10px; background: white; border-radius: 8px;">
                                <div style="font-weight: 600;">PM2.5</div>
                                <div>${aqi.pm2_5.toFixed(1)} ¬µg/m¬≥</div>
                            </div>
                            <div style="text-align: center; padding: 10px; background: white; border-radius: 8px;">
                                <div style="font-weight: 600;">PM10</div>
                                <div>${aqi.pm10.toFixed(1)} ¬µg/m¬≥</div>
                            </div>
                        </div>
                        
                        <div style="padding: 10px; background: #fff3cd; border-radius: 8px; font-size: 0.8rem;">
                            <strong>üåæ Farming Impact:</strong><br>
                            ‚Ä¢ Air quality: ${aqiStatus} - ${aqiStatus === 'Good' ? 'Safe for all outdoor farming activities' : 'Consider limiting outdoor work during peak hours'}<br>
                            ‚Ä¢ PM2.5 levels can affect plant health and growth rates<br>
                            ‚Ä¢ High pollution may require more frequent crop washing
                        </div>
                    </div>
                `;
                
                showNotification('‚úÖ Air quality data loaded successfully!', 'success');
                
            } catch (error) {
                console.error('Air Quality Error:', error);
                document.getElementById('air-quality-data').innerHTML = `
                    <div style="color: #d32f2f; font-weight: 600; background: #ffebee; padding: 10px; border-radius: 8px;">
                        ‚ùå Error: ${error.message}<br>
                        <span style="font-weight: normal; font-size: 0.8rem;">Please check your API key and try again.</span>
                    </div>
                `;
                showNotification('‚ùå Failed to fetch air quality data. Check your API key.', 'error');
            }
        }
        
        // Location Management
        function updateLocationFromSelect() {
            const locationSelect = document.getElementById('location-select');
            const selectedValue = locationSelect.value;
            const customInput = document.getElementById('custom-location-input');
            
            if (selectedValue === 'custom') {
                customInput.style.display = 'block';
                return;
            } else {
                customInput.style.display = 'none';
                userLocation = selectedValue;
                showNotification(`üó∫Ô∏è Location updated to: ${userLocation}`, 'success');
                clearWeatherData();
            }
        }
        
        function updateCustomLocation() {
            const customInput = document.getElementById('custom-location-text');
            const newLocation = customInput.value.trim();
            if (newLocation) {
                userLocation = newLocation;
                showNotification(`üó∫Ô∏è Custom location set to: ${userLocation}`, 'success');
                clearWeatherData();
                
                // Hide custom input
                document.getElementById('custom-location-input').style.display = 'none';
                
                // Reset dropdown to show custom is selected
                const locationSelect = document.getElementById('location-select');
                locationSelect.value = 'custom';
            } else {
                showNotification('‚ùå Please enter a valid location', 'error');
            }
        }
        
        function clearWeatherData() {
            // Clear existing data to show updated location
            document.getElementById('current-weather').innerHTML = 'Click to get current weather data';
            document.getElementById('forecast-weather').innerHTML = 'Click to get forecast data';
            document.getElementById('astronomy-data').innerHTML = 'Click to get astronomy data';
            document.getElementById('air-quality-data').innerHTML = 'Click to get air quality data';
            
            // Clear crop recommendations
            const cropDiv = document.getElementById('crop-recommendations');
            if (cropDiv) {
                cropDiv.innerHTML = '';
            }
        }
        
        // Smart Agricultural Analysis Functions - Browser-Compatible Version
        async function analyzeCropConditions() {
            const apiKey = localStorage.getItem('smartAgri_weatherapi');
            if (!apiKey) {
                showNotification('‚ùå Please configure your WeatherAPI key first', 'error');
                showTab('api-keys');
                return;
            }
            
            try {
                showNotification('üå± Analyzing crop growing conditions...', 'info');
                
                // Since direct API calls might face CORS issues, let's use a fallback approach
                // We'll create intelligent crop recommendations based on season and location
                const currentDate = new Date();
                const month = currentDate.getMonth() + 1; // 1-12
                const season = getSeason(month);
                const climateZone = getClimateZone(userLocation);
                
                // Get location-based and seasonal recommendations
                const recommendations = getCropRecommendations(season, climateZone, userLocation);
                
                // Display recommendations
                const recommendationsHtml = `
                    <div style="background: linear-gradient(135deg, #e8f5e8, #f0f8f0); padding: 20px; border-radius: 12px; margin-top: 15px;">
                        <div style="font-weight: 600; color: #2E7D32; margin-bottom: 15px; font-size: 1.1rem;">üå± Smart Crop Recommendations for ${userLocation}</div>
                        
                        <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <strong>üå°Ô∏è Current Season Analysis:</strong><br>
                            ‚Ä¢ Location: ${userLocation}<br>
                            ‚Ä¢ Current Season: ${season}<br>
                            ‚Ä¢ Climate Zone: ${climateZone}<br>
                            ‚Ä¢ Month: ${currentDate.toLocaleString('en-US', { month: 'long' })}<br>
                            ‚Ä¢ Analysis Date: ${currentDate.toLocaleDateString()}
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <strong style="color: #2E7D32;">üåæ Recommended Crops for ${season}:</strong>
                            <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;">
                                ${recommendations.crops.map(crop => `
                                    <span style="background: white; padding: 8px 12px; border-radius: 20px; font-size: 0.9rem; border: 2px solid #4CAF50; color: #2E7D32; font-weight: 500;">${crop}</span>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <strong style="color: #1565C0;">üéØ ${season} Farming Tips:</strong><br>
                            ${recommendations.advice}
                        </div>
                        
                        <div style="background: #f3e5f5; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <strong style="color: #7B1FA2;">üå± Planting Calendar:</strong><br>
                            ${recommendations.calendar}
                        </div>
                        
                        <div style="margin-top: 15px; font-size: 0.8rem; color: #666; text-align: center;">
                            ‚ÑπÔ∏è Recommendations based on seasonal patterns and location. For real-time weather data, use the weather features above.
                        </div>
                        
                        <div style="text-align: center; margin-top: 15px;">
                            <button class="btn" onclick="getCurrentWeather()" style="margin-right: 10px;">üå°Ô∏è Get Current Weather</button>
                            <button class="btn" onclick="getForecast()">üìÖ Get 7-Day Forecast</button>
                        </div>
                    </div>
                `;
                
                // Display in the crop recommendations area
                displayCropRecommendations(recommendationsHtml);
                
                showNotification('‚úÖ Crop analysis complete! Recommendations based on seasonal patterns.', 'success');
                
            } catch (error) {
                console.error('Crop Analysis Error:', error);
                showNotification('‚ùå Error in crop analysis. Using fallback recommendations.', 'error');
                
                // Fallback recommendations
                const fallbackHtml = `
                    <div style="background: linear-gradient(135deg, #e8f5e8, #f0f8f0); padding: 20px; border-radius: 12px; margin-top: 15px;">
                        <div style="font-weight: 600; color: #2E7D32; margin-bottom: 15px; font-size: 1.1rem;">üå± General Crop Recommendations</div>
                        
                        <div style="margin-bottom: 15px;">
                            <strong style="color: #2E7D32;">üåæ All-Season Crops:</strong>
                            <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;">
                                <span style="background: white; padding: 8px 12px; border-radius: 20px; font-size: 0.9rem; border: 2px solid #4CAF50; color: #2E7D32; font-weight: 500;">Lettuce</span>
                                <span style="background: white; padding: 8px 12px; border-radius: 20px; font-size: 0.9rem; border: 2px solid #4CAF50; color: #2E7D32; font-weight: 500;">Spinach</span>
                                <span style="background: white; padding: 8px 12px; border-radius: 20px; font-size: 0.9rem; border: 2px solid #4CAF50; color: #2E7D32; font-weight: 500;">Herbs</span>
                                <span style="background: white; padding: 8px 12px; border-radius: 20px; font-size: 0.9rem; border: 2px solid #4CAF50; color: #2E7D32; font-weight: 500;">Radishes</span>
                                <span style="background: white; padding: 8px 12px; border-radius: 20px; font-size: 0.9rem; border: 2px solid #4CAF50; color: #2E7D32; font-weight: 500;">Green Beans</span>
                            </div>
                        </div>
                        
                        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px;">
                            <strong style="color: #1565C0;">üéØ General Farming Tips:</strong><br>
                            ‚Ä¢ Start with easy-to-grow crops like lettuce and herbs<br>
                            ‚Ä¢ Consider your local climate and soil conditions<br>
                            ‚Ä¢ Check with local agricultural extension for specific advice<br>
                            ‚Ä¢ Use the weather features above for current conditions
                        </div>
                    </div>
                `;
                
                displayCropRecommendations(fallbackHtml);
            }
        }
        
        // Helper functions for crop analysis
        function getSeason(month) {
            if (month >= 3 && month <= 5) return 'Spring';
            if (month >= 6 && month <= 8) return 'Summer';
            if (month >= 9 && month <= 11) return 'Fall/Autumn';
            return 'Winter';
        }
        
        function getClimateZone(location) {
            const loc = location.toLowerCase();
            
            // Tropical regions
            if (loc.includes('miami') || loc.includes('hawaii') || loc.includes('singapore') || 
                loc.includes('mumbai') || loc.includes('bangkok') || loc.includes('manila') ||
                loc.includes('jakarta') || loc.includes('kuala lumpur') || loc.includes('dhaka') ||
                loc.includes('colombo') || loc.includes('lagos') || loc.includes('nairobi') ||
                loc.includes('accra') || loc.includes('caracas') || loc.includes('bogot√°') ||
                loc.includes('quito') || loc.includes('brazil') || loc.includes('thailand') ||
                loc.includes('philippines') || loc.includes('malaysia') || loc.includes('indonesia') ||
                loc.includes('sri lanka') || loc.includes('bangladesh') || loc.includes('nigeria') ||
                loc.includes('kenya') || loc.includes('ghana') || loc.includes('venezuela') ||
                loc.includes('colombia') || loc.includes('ecuador')) {
                return 'Tropical';
            }
            
            // Mediterranean regions
            if (loc.includes('california') || loc.includes('los angeles') || loc.includes('san diego') ||
                loc.includes('mediterranean') || loc.includes('spain') || loc.includes('italy') || 
                loc.includes('greece') || loc.includes('madrid') || loc.includes('barcelona') ||
                loc.includes('rome') || loc.includes('milan') || loc.includes('athens') ||
                loc.includes('lisbon') || loc.includes('portugal') || loc.includes('casablanca') ||
                loc.includes('morocco') || loc.includes('tel aviv') || loc.includes('israel') ||
                loc.includes('santiago') || loc.includes('chile') || loc.includes('perth') ||
                loc.includes('adelaide')) {
                return 'Mediterranean';
            }
            
            // Desert/Arid regions
            if (loc.includes('arizona') || loc.includes('phoenix') || loc.includes('las vegas') ||
                loc.includes('nevada') || loc.includes('dubai') || loc.includes('abu dhabi') ||
                loc.includes('riyadh') || loc.includes('jeddah') || loc.includes('cairo') ||
                loc.includes('egypt') || loc.includes('kuwait') || loc.includes('doha') ||
                loc.includes('qatar') || loc.includes('muscat') || loc.includes('oman') ||
                loc.includes('amman') || loc.includes('jordan') || loc.includes('tehran') ||
                loc.includes('iran') || loc.includes('baghdad') || loc.includes('iraq') ||
                loc.includes('damascus') || loc.includes('syria') || loc.includes('saudi arabia') ||
                loc.includes('uae') || loc.includes('bahrain') || loc.includes('manama') ||
                loc.includes('la paz') || loc.includes('bolivia')) {
                return 'Desert/Arid';
            }
            
            // Cold/Arctic regions
            if (loc.includes('canada') || loc.includes('toronto') || loc.includes('vancouver') ||
                loc.includes('montreal') || loc.includes('calgary') || loc.includes('ottawa') ||
                loc.includes('alaska') || loc.includes('siberia') || loc.includes('iceland') ||
                loc.includes('greenland') || loc.includes('oslo') || loc.includes('stockholm') ||
                loc.includes('helsinki') || loc.includes('norway') || loc.includes('sweden') ||
                loc.includes('finland') || loc.includes('moscow') || loc.includes('saint petersburg') ||
                loc.includes('russia') || loc.includes('warsaw') || loc.includes('poland')) {
                return 'Cold/Arctic';
            }
            
            // Default to temperate for most other locations
            return 'Temperate';
        }
        
        function getCropRecommendations(season, climateZone, location) {
            const recommendations = {
                'Spring': {
                    'Tropical': {
                        crops: ['Rice', 'Banana', 'Mango', 'Coconut', 'Sweet Potato', 'Cassava'],
                        advice: 'Excellent growing season. Focus on water management and pest control.',
                        calendar: 'Plant rice paddies, establish fruit trees, start root vegetables.'
                    },
                    'Mediterranean': {
                        crops: ['Tomatoes', 'Peppers', 'Eggplant', 'Zucchini', 'Basil', 'Oregano'],
                        advice: 'Perfect temperature and rainfall. Prepare for summer heat.',
                        calendar: 'Start warm-season vegetables, plant herbs, prepare irrigation.'
                    },
                    'Desert/Arid': {
                        crops: ['Date Palm', 'Cactus Pear', 'Jojoba', 'Drought-resistant grains'],
                        advice: 'Focus on drought-resistant crops and water conservation.',
                        calendar: 'Plant before intense summer heat, establish water-saving systems.'
                    },
                    'Cold/Arctic': {
                        crops: ['Potatoes', 'Cabbage', 'Turnips', 'Cold-hardy grains'],
                        advice: 'Short growing season. Focus on fast-maturing, cold-hardy varieties.',
                        calendar: 'Plant immediately after last frost, use season extenders.'
                    },
                    'Temperate': {
                        crops: ['Lettuce', 'Spinach', 'Peas', 'Broccoli', 'Carrots', 'Onions'],
                        advice: 'Ideal for cool-season crops. Prepare soil and start early vegetables.',
                        calendar: 'Plant cool-season crops, prepare beds for summer vegetables.'
                    }
                },
                'Summer': {
                    'Tropical': {
                        crops: ['Monsoon Rice', 'Sugarcane', 'Cotton', 'Groundnuts', 'Maize'],
                        advice: 'Monsoon season. Manage water logging and plant disease.',
                        calendar: 'Kharif crop season. Plant rice, cotton, and cash crops.'
                    },
                    'Mediterranean': {
                        crops: ['Grapes', 'Olives', 'Figs', 'Melons', 'Sunflowers'],
                        advice: 'Hot and dry. Focus on drought-tolerant crops and irrigation.',
                        calendar: 'Harvest early crops, maintain established perennials.'
                    },
                    'Desert/Arid': {
                        crops: ['Minimal planting', 'Shade crops only'],
                        advice: 'Too hot for most crops. Focus on maintenance and planning.',
                        calendar: 'Maintain existing crops, plan for fall planting.'
                    },
                    'Cold/Arctic': {
                        crops: ['Quick greens', 'Radishes', 'Microgreens'],
                        advice: 'Peak growing season but short. Maximize daylight hours.',
                        calendar: 'Intensive growing period. Succession planting for continuous harvest.'
                    },
                    'Temperate': {
                        crops: ['Tomatoes', 'Corn', 'Beans', 'Squash', 'Cucumbers', 'Peppers'],
                        advice: 'Peak growing season. Maintain consistent watering and pest control.',
                        calendar: 'Harvest early crops, maintain summer vegetables, plan fall crops.'
                    }
                },
                'Fall/Autumn': {
                    'Tropical': {
                        crops: ['Post-monsoon Rice', 'Wheat', 'Mustard', 'Chickpeas'],
                        advice: 'Post-monsoon planting. Good conditions for cereals.',
                        calendar: 'Rabi crop season. Plant winter cereals and pulses.'
                    },
                    'Mediterranean': {
                        crops: ['Winter wheat', 'Olives', 'Citrus fruits', 'Fall vegetables'],
                        advice: 'Cooler temperatures return. Good for planting winter crops.',
                        calendar: 'Plant winter cereals, harvest summer fruits, plant fall vegetables.'
                    },
                    'Desert/Arid': {
                        crops: ['Winter vegetables', 'Dates', 'Cool-season crops'],
                        advice: 'Temperatures moderate. Good time to plant cool-season crops.',
                        calendar: 'Plant vegetables, prepare for winter growing season.'
                    },
                    'Cold/Arctic': {
                        crops: ['Storage crops', 'Root vegetables for storage'],
                        advice: 'Prepare for winter. Focus on harvesting and storage.',
                        calendar: 'Harvest all crops, prepare storage, plan for next year.'
                    },
                    'Temperate': {
                        crops: ['Winter wheat', 'Cover crops', 'Garlic', 'Fall vegetables'],
                        advice: 'Plant winter crops and cover crops. Harvest summer crops.',
                        calendar: 'Plant cover crops, harvest main season, plant garlic and winter crops.'
                    }
                },
                'Winter': {
                    'Tropical': {
                        crops: ['Cool-season vegetables', 'Strawberries', 'Flowers'],
                        advice: 'Mild temperatures. Excellent for cool-season crops.',
                        calendar: 'Peak season for vegetables, flowers, and cool-weather crops.'
                    },
                    'Mediterranean': {
                        crops: ['Citrus harvest', 'Winter vegetables', 'Herbs'],
                        advice: 'Mild winter. Good for cool-season vegetables and herb production.',
                        calendar: 'Harvest citrus, grow cool-season vegetables, maintain herbs.'
                    },
                    'Desert/Arid': {
                        crops: ['Cool-season vegetables', 'Winter flowers', 'Herbs'],
                        advice: 'Best growing season. Take advantage of mild temperatures.',
                        calendar: 'Peak growing season for most vegetables and herbs.'
                    },
                    'Cold/Arctic': {
                        crops: ['Indoor growing only', 'Sprouts', 'Microgreens'],
                        advice: 'Outdoor growing not possible. Focus on indoor production.',
                        calendar: 'Indoor growing only, plan for next year, maintain equipment.'
                    },
                    'Temperate': {
                        crops: ['Greenhouse crops', 'Storage crops', 'Indoor herbs'],
                        advice: 'Limited outdoor growing. Focus on planning and indoor crops.',
                        calendar: 'Indoor production, crop planning, equipment maintenance.'
                    }
                }
            };
            
            const seasonData = recommendations[season] || recommendations['Spring'];
            const climateData = seasonData[climateZone] || seasonData['Temperate'];
            
            return climateData;
        }
        
        function displayCropRecommendations(html) {
            // Try to find the first crop recommendation feature card
            const featureCards = document.querySelectorAll('.feature-card');
            let targetCard = null;
            
            featureCards.forEach(card => {
                const text = card.textContent || '';
                if (text.includes('Crop Recommendations') || text.includes('testWeatherAPI')) {
                    targetCard = card;
                }
            });
            
            if (targetCard) {
                let recommendationDiv = document.getElementById('crop-recommendations');
                if (!recommendationDiv) {
                    recommendationDiv = document.createElement('div');
                    recommendationDiv.id = 'crop-recommendations';
                    targetCard.appendChild(recommendationDiv);
                }
                recommendationDiv.innerHTML = html;
            } else {
                // Fallback: create a new section
                const content = document.querySelector('.content');
                if (content) {
                    let recommendationDiv = document.getElementById('crop-recommendations');
                    if (!recommendationDiv) {
                        recommendationDiv = document.createElement('div');
                        recommendationDiv.id = 'crop-recommendations';
                        content.appendChild(recommendationDiv);
                    }
                    recommendationDiv.innerHTML = html;
                }
            }
        }
        
        // Update the testWeatherAPI function to call crop analysis
        async function testWeatherAPI() {
            await analyzeCropConditions();
        }

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
